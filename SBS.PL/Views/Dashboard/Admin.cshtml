@using WEBPage.Models.Identity
@model IList<ApplicationUser>

<style>
    table {
        width: 100%; /* Full width table */
        font-size: 18px; /* Increased font size for readability */
        border-collapse: separate; /* Prevent collapsing borders */
        border-spacing: 0 10px; /* Add space between rows */
    }

    th, td {
        padding: 15px 20px; /* Add padding for more space in cells */
        text-align: left; /* Left align text for better readability */
    }

    /* First row (header) styling */
    tr:first-of-type {
        background-color: #0d7a5f; /* Green background for first row */
        color: white; /* White text for contrast */
        font-weight: bold; /* Make the text bold */
    }

        tr:first-of-type th {
            padding: 20px 25px; /* More padding for the header cells */
            border-right: 2px solid white; /* Add space between header columns */
            font-size: 20px; /* Larger font size for the header */
        }

    th:last-child, td:last-child {
        border-right: none; /* No right border on the last column */
    }

    /* Links styling (Edit and Delete) */
    a.edit-link, a.delete-link {
        text-decoration: none; /* Remove underline */
        display: inline-flex; /* Display as inline flex for icon alignment */
        align-items: center; /* Vertically center text and icon */
    }


    /* Delete link styling */
    a.delete-link {
        color: red; /* Red delete link */
        font-weight: bold;
    }

        a.delete-link:hover {
            color: darkred; /* Darker red on hover */
        }

    /* Add subtle shadow to table */
    table {
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1); /* Soft shadow */
    }

    /* Button styling */
    .btn-add {
        background-color: #0d7a5f; /* Button background */
        color: white; /* Button text color */
        border: none; /* Remove border */
        padding: 10px 20px; /* Button padding */
        font-size: 18px; /* Font size */
        margin-top: 15px; /* Space above the button */
        cursor: pointer; /* Change cursor to pointer on hover */
        display: inline-block;
    }

        .btn-add:hover {
            background-color: #0b6a53; /* Darker green on hover */
        }

</style>

<!-- Delete User Modal -->
<div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteUserModalLabel">Delete Confirmation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this user?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
            </div>
        </div>
    </div>
</div>

<table>
    <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Edit</th>
        <th>Delete</th>
    </tr>
    @foreach (var item in Model)
    {
        <tr>
            <td>@(@item.FirstName + " " + item.LastName)</td>
            <td>@item.Email</td>
            <td><a asp-action="Edit" class="edit-link">Edit</a></td>
            <td>
                <button class="btn btn-danger" data-email="@item.Email" data-bs-toggle="modal" data-bs-target="#deleteUserModal">Delete</button>
            </td>
        </tr>
    }
</table>

<!-- Button for adding a new admin -->
<button class="btn-add" onclick="location.href='@Url.Action("AddAdmin")'" asp-action="AddAdmin">Add New Admin</button>

</table>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
$(document).ready(function () {
    var userEmailToDelete = '';

    // Capture the user's email when the delete button is clicked and the modal is opened
    $('#deleteUserModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Button that triggered the modal
        userEmailToDelete = button.data('email'); // Extract email from data-* attributes
    });

    // Handle the "Delete" button in the modal (confirmed delete action)
    $('#confirmDelete').click(function () {
        if (userEmailToDelete) {
            // Make an AJAX POST request to delete the user
            $.ajax({
                url: '@Url.Action("DeleteUserByEmail", "Dashboard")',
                type: 'POST',
                data: { email: userEmailToDelete },
                success: function (response) {
                    alert(response); // Show success or failure message
                    location.reload(); // Reload the page to reflect the changes
                },
                error: function () {
                    alert('Error occurred while deleting the user.');
                }
            });

            // Close the modal
            $('#deleteUserModal').modal('hide');
        }
    });
});
</script>

